{
  "ruleChain": {
    "additionalInfo": {
      "description": ""
    },
    "name": "Refresh",
    "type": "CORE",
    "firstRuleNodeId": null,
    "root": false,
    "debugMode": false,
    "configuration": null,
    "externalId": null
  },
  "metadata": {
    "firstNodeIndex": 1,
    "nodes": [
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 618,
          "layoutY": 152
        },
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Check if queryapiserver",
        "debugMode": true,
        "configuration": {
          "scriptLang": "JS",
          "jsScript": "return msg.method == \"querypodstats\";",
          "tbelScript": null
        },
        "externalId": null
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 304,
          "layoutY": 149
        },
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Check if INB device",
        "debugMode": true,
        "configuration": {
          "jsScript": "return metadata.deviceType === \"INB\";"
        },
        "externalId": null
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 910,
          "layoutY": 282
        },
        "type": "org.thingsboard.rule.engine.rest.TbRestApiCallNode",
        "name": "Send GET api request",
        "debugMode": true,
        "configuration": {
          "restEndpointUrlPattern": "${endpoint}/v1/dashboard?nodename=${deviceName}",
          "requestMethod": "GET",
          "useSimpleClientHttpFactory": false,
          "ignoreRequestBody": true,
          "enableProxy": false,
          "useSystemProxyProperties": true,
          "proxyScheme": "https",
          "proxyHost": "http://proxy-dmz.intel.com",
          "proxyPort": 912,
          "proxyUser": null,
          "proxyPassword": null,
          "readTimeoutMs": 20000,
          "maxParallelRequestsCount": 0,
          "headers": {},
          "useRedisQueueForMsgPersistence": false,
          "trimQueue": false,
          "maxQueueSize": 0,
          "credentials": {
            "type": "anonymous"
          }
        },
        "externalId": null
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 1221,
          "layoutY": 620
        },
        "type": "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode",
        "name": "Save logs",
        "debugMode": true,
        "configuration": {
          "defaultTTL": 0,
          "skipLatestPersistence": false,
          "useServerTs": false
        },
        "externalId": null
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 1227,
          "layoutY": 513
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Add logs body",
        "debugMode": true,
        "configuration": {
          "scriptLang": "JS",
          "jsScript": "var body = {\r\n    \"event\": msg\r\n};\r\n\r\nmsgType = \"POST_TELEMETRY_REQUEST\";\r\nreturn { msg: body, metadata: metadata, msgType: msgType }",
          "tbelScript": null
        },
        "externalId": null
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 1221,
          "layoutY": 388
        },
        "type": "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode",
        "name": "Save nodeStats Attribute",
        "debugMode": true,
        "configuration": {
          "scope": "CLIENT_SCOPE",
          "notifyDevice": false,
          "sendAttributesUpdatedNotification": false
        },
        "externalId": null
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 1222,
          "layoutY": 282
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Update Attribute",
        "debugMode": true,
        "configuration": {
          "scriptLang": "JS",
          "jsScript": "if (!msg.attributes) {\r\n  msg.attributes = {\r\n    nodeStats: JSON.stringify(msg),\r\n    nlm_endpoint: metadata.endpoint\r\n  }\r\n};\r\n\r\nmsgType = \"POST_ATTRIBUTES_REQUEST\";\r\nreturn { msg: msg.attributes, metadata: metadata, msgType: msgType }",
          "tbelScript": null
        },
        "externalId": null
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 1239,
          "layoutY": 155
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Update nodeStats Attribute",
        "debugMode": true,
        "configuration": {
          "scriptLang": "JS",
          "jsScript": "var params = JSON.parse(msg.params);\r\nmetadata.endpoint = params[\"endpoint\"];\r\n\r\nif (!metadata.endpoint){\r\n    metadata.endpoint = metadata.cs_nlm_endpoint;\r\n}\r\n\r\nreturn {msg: {}, metadata: metadata, msgType: msgType};",
          "tbelScript": null
        },
        "externalId": null
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 918,
          "layoutY": 155
        },
        "type": "org.thingsboard.rule.engine.metadata.TbGetAttributesNode",
        "name": "Read information from dashboard",
        "debugMode": true,
        "configuration": {
          "tellFailureIfAbsent": false,
          "fetchToData": false,
          "clientAttributeNames": [
            "nlm_endpoint"
          ],
          "sharedAttributeNames": [],
          "serverAttributeNames": [],
          "latestTsKeyNames": [],
          "getLatestValueWithTs": false
        },
        "externalId": null
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 976,
          "layoutY": 514
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Add error body",
        "debugMode": true,
        "configuration": {
          "scriptLang": "JS",
          "jsScript": "var body = {\r\n    \"event\": metadata.error\r\n};\r\n\r\nmsgType = \"POST_TELEMETRY_REQUEST\";\r\nreturn { msg: body, metadata: metadata, msgType: msgType }",
          "tbelScript": null
        },
        "externalId": null
      }
    ],
    "connections": [
      {
        "fromIndex": 0,
        "toIndex": 8,
        "type": "True"
      },
      {
        "fromIndex": 1,
        "toIndex": 0,
        "type": "True"
      },
      {
        "fromIndex": 2,
        "toIndex": 4,
        "type": "Success"
      },
      {
        "fromIndex": 2,
        "toIndex": 6,
        "type": "Success"
      },
      {
        "fromIndex": 2,
        "toIndex": 9,
        "type": "Failure"
      },
      {
        "fromIndex": 4,
        "toIndex": 3,
        "type": "Success"
      },
      {
        "fromIndex": 6,
        "toIndex": 5,
        "type": "Success"
      },
      {
        "fromIndex": 7,
        "toIndex": 2,
        "type": "Success"
      },
      {
        "fromIndex": 8,
        "toIndex": 7,
        "type": "Success"
      },
      {
        "fromIndex": 9,
        "toIndex": 3,
        "type": "Success"
      }
    ],
    "ruleChainConnections": null
  }
}